

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Unit Tests in MARBL &mdash; MARBL cesm2.1 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="MARBL cesm2.1 documentation" href="../../index.html"/>
        <link rel="up" title="The MARBL Standalone Driver" href="index.html"/>
        <link rel="next" title="Regression Tests in MARBL" href="regression_tests.html"/>
        <link rel="prev" title="Testing the MARBL Build System" href="build_tests.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> MARBL
          

          
          </a>

          
            
            
              <div class="version">
                
                  <div class="version-dropdown">
                    <select class="version-list" id="version-list">
                      <option value=''>cesm2.1</option>
                      
                        
                          <option value="../latest">latest</option>
                        
                      
                        
                      
                    </select>
                  </div>
                
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../index.html">Marine Biogeochemistry Library</a></li>
</ul>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../usr-guide/index.html">MARBL user guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Examples of MARBL Implementation</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html">The MARBL Standalone Driver</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="build_tests.html">Testing the MARBL Build System</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Unit Tests in MARBL</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#testing-the-get-and-put-subroutines">Testing the <code class="docutils literal notranslate"><span class="pre">get()</span></code> and <code class="docutils literal notranslate"><span class="pre">put()</span></code> subroutines</a></li>
<li class="toctree-l4"><a class="reference internal" href="#testing-additional-small-subroutines">Testing additional small subroutines</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="regression_tests.html">Regression Tests in MARBL</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../pop/index.html">MARBL examples in POP</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../dev-guide/index.html">MARBL developer’s guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sci-guide/index.html">MARBL scientific documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev-guide/repo-access/index.html">Rules of engagement</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">MARBL</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Examples of MARBL Implementation</a> &raquo;</li>
        
          <li><a href="index.html">The MARBL Standalone Driver</a> &raquo;</li>
        
      <li>Unit Tests in MARBL</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/implementations/standalone/unit_tests.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="unit-tests-in-marbl">
<span id="unit-tests"></span><h1>Unit Tests in MARBL<a class="headerlink" href="#unit-tests-in-marbl" title="Permalink to this headline">¶</a></h1>
<p>There are two subdirectories in <code class="docutils literal notranslate"><span class="pre">$MARBLROOT/tests/unit_tests</span></code>: <code class="docutils literal notranslate"><span class="pre">get_put/</span></code> and <code class="docutils literal notranslate"><span class="pre">utils_routines/</span></code>.
Each contains a python script that launches a test to check the correctness of a small piece of the MARBL code base.</p>
<div class="section" id="testing-the-get-and-put-subroutines">
<h2>Testing the <code class="docutils literal notranslate"><span class="pre">get()</span></code> and <code class="docutils literal notranslate"><span class="pre">put()</span></code> subroutines<a class="headerlink" href="#testing-the-get-and-put-subroutines" title="Permalink to this headline">¶</a></h2>
<p>This test is designed to ensure the variable names passed to <code class="docutils literal notranslate"><span class="pre">marbl_instance%put()</span></code> alter the correct variable in memory.
All logical variables are set to <code class="docutils literal notranslate"><span class="pre">.true.</span></code>, string variables are set to <code class="docutils literal notranslate"><span class="pre">'-1'</span></code>, and numeric variables are set to <code class="docutils literal notranslate"><span class="pre">-1</span></code>.
Then values are checked via <code class="docutils literal notranslate"><span class="pre">marbl_instance%get()</span></code> – any values that are not <code class="docutils literal notranslate"><span class="pre">.true.</span></code> or <code class="docutils literal notranslate"><span class="pre">-1</span></code> were not set properly.</p>
<p>This builds upon error checks in the MARBL code base itself.
Here is output from a failing test, where <code class="docutils literal notranslate"><span class="pre">gQsi_min</span></code> inadvertently points to <code class="docutils literal notranslate"><span class="pre">gQsi_max</span></code> in memory:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Beginning get_put test...
MARBL ERROR (marbl_settings_mod:add_var): gQsi_min and gQsi_max both point to same variable in memory.
MARBL ERROR (marbl_settings_mod:marbl_settings_define_general_parms): Error reported from this%add_var(gQsi_min)
MARBL ERROR (marbl_init_mod:marbl_init_parameters_pre_tracers): Error reported from marbl_settings_define_general_parms()
MARBL ERROR (marbl_interface:init): Error reported from marbl_init_parameters_pre_tracers
MARBL ERROR (marbl_get_put_drv:test): Error reported from marbl_loc%init
STOP 1
(run_exe): ERROR in executable
</pre></div>
</div>
<p>Perhaps this unit test has been deprecated, as the above error appears when running any executable that initializes a MARBL instance.
The expected output from the test is:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Beginning get_put test...
Setting variables to .true. or -1 ...
... Done!
Making sure variables are .true. or -1
... Done!

-------------
Timer summary
-------------

There are 4 timers being returned
----
MARBL Init:       0.141 seconds
MARBL surface_flux_compute:       0.000 seconds
MARBL interior_tendency_compute:       0.000 seconds
MARBL carbonate chemistry:       0.000 seconds
</pre></div>
</div>
</div>
<div class="section" id="testing-additional-small-subroutines">
<h2>Testing additional small subroutines<a class="headerlink" href="#testing-additional-small-subroutines" title="Permalink to this headline">¶</a></h2>
<p>There are two small utility functions in <code class="docutils literal notranslate"><span class="pre">marbl_utils_mod</span></code> that MARBL relies on,
and both of them are tested for correctness.</p>
<p>The first is <code class="docutils literal notranslate"><span class="pre">marbl_utils_linear_root</span></code> – given two points in <code class="docutils literal notranslate"><span class="pre">(x,</span> <span class="pre">y)</span></code> space,
this function returns a linear root between the point if one exists.
It is used to compute the saturation depth for calcite and argonite.
The unit tests ensure that several conditions are handled correctly:</p>
<ol class="arabic simple">
<li>Finding a root when increasing from a negative value to a positive value</li>
<li>The same, but passing in the point with the larger <code class="docutils literal notranslate"><span class="pre">x</span></code> value first</li>
<li>Finding a root when decreasing from a positive value to a negative value</li>
<li>The same, but passing in the point with the larger <code class="docutils literal notranslate"><span class="pre">x</span></code> value first</li>
<li>Finding a root when the <code class="docutils literal notranslate"><span class="pre">y</span></code> value at the left endpoint is 0
(should return the left endpoint <code class="docutils literal notranslate"><span class="pre">x</span></code> value)</li>
<li>Finding a root when the <code class="docutils literal notranslate"><span class="pre">y</span></code> value at the right endpoint is 0
(should return the right endpoint <code class="docutils literal notranslate"><span class="pre">x</span></code> value)</li>
<li>Finding a root when the <code class="docutils literal notranslate"><span class="pre">y</span></code> value at both endpoints are 0
(should return the right endpoint <code class="docutils literal notranslate"><span class="pre">x</span></code> value)</li>
<li>Determining that no root exists if both <code class="docutils literal notranslate"><span class="pre">y</span></code> values are positive</li>
<li>Determining that no root exists if both <code class="docutils literal notranslate"><span class="pre">y</span></code> values are negative</li>
</ol>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>-----------------
Linear Root Tests
-----------------

PASS: Test 1 [linear root: root between (1.0, -1.0) and (2.0, 1.0)]
      Root at x = 1.5
PASS: Test 2 [linear root: root between (2.0, 1.0) and (1.0, -1.0)]
      Root at x = 1.5
PASS: Test 3 [linear root: root between (1.0, 1.0) and (2.0, -1.0)]
      Root at x = 1.5
PASS: Test 4 [linear root: root between (2.0, -1.0) and (1.0, 1.0)]
      Root at x = 1.5
PASS: Test 5 [linear root: root between (5.0, .0) and (7.0, 3.0)]
      Root at x = 5.0
PASS: Test 6 [linear root: root between (5.0, 3.0) and (7.0, .0)]
      Root at x = 7.0
PASS: Test 7 [linear root: root between (5.0, .0) and (7.0, .0)]
      Root at x = 7.0
PASS: Test 8 (linear root: root between (1.0, 1.0) and (2.0, 3.0)]
      No root found
PASS: Test 9 (linear root: root between (1.0, -1.0) and (2.0, -3.0)]
      No root found

** passed all linear root tests **
</pre></div>
</div>
<p>There second function, <code class="docutils literal notranslate"><span class="pre">marbl_utils_str_to_substrs()</span></code>, takes a string and a delimiter as arguments and returns
an array of substrings where each substring ends before a delimiter and the next substring starts after.
This is useful when the settings file defines values for an array, such as over-riding the first five elements of <code class="docutils literal notranslate"><span class="pre">tracer_restore_vars</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>tracer_restore_vars = &#39;&#39;,&#39;&#39;,&#39;&#39;,&#39;&#39;,&#39;&#39;
</pre></div>
</div>
<p>It is also useful for ignoring comments in the settings file, which use the <code class="docutils literal notranslate"><span class="pre">!</span></code> character. In both of these cases,
it is important to ensure that if the delimiter appears within a string itself then it is not treated as a delimiter.
The tests for this subroutine are:</p>
<ol class="arabic simple">
<li>If the delimiter is <code class="docutils literal notranslate"><span class="pre">,</span></code> then a string with no <code class="docutils literal notranslate"><span class="pre">,</span></code> returns a single substring equal to the original string</li>
<li>If the delimiter is <code class="docutils literal notranslate"><span class="pre">,</span></code> then a string with a <code class="docutils literal notranslate"><span class="pre">,</span></code> is broken into two substrings</li>
<li>If the delimiter is <code class="docutils literal notranslate"><span class="pre">,</span></code> then a <code class="docutils literal notranslate"><span class="pre">,</span></code> appearing between two <code class="docutils literal notranslate"><span class="pre">'</span></code> is ignored</li>
<li>If the delimiter is <code class="docutils literal notranslate"><span class="pre">!</span></code> then the first substring only contains text leading up to the first <code class="docutils literal notranslate"><span class="pre">!</span></code></li>
<li>If the delimiter is <code class="docutils literal notranslate"><span class="pre">!</span></code> then a <code class="docutils literal notranslate"><span class="pre">!</span></code> appearing between two <code class="docutils literal notranslate"><span class="pre">'</span></code> is ignored</li>
</ol>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>--------------------------
String -&gt; Substrings Tests
--------------------------

PASS: Test 1 (str_to_substrs: .true.)
      substr(1): .true.
PASS: Test 2 (str_to_substrs: 123, 456)
      substr(1): 123
      substr(2):  456
PASS: Test 3 (str_to_substrs: &#39;ABC, DEF&#39;, &#39;GHI&#39;)
      substr(1): &#39;ABC, DEF&#39;
      substr(2):  &#39;GHI&#39;

** passed all string to substrings tests **

-----------------------
Comment-Stripping Tests
-----------------------

PASS: Test 1 (strip_comments: ciso_on = .true.  ! Turn on ciso)
      string: ciso_on = .true.
PASS: Test 2 (strip_comments: autotrophs(1)%lname=&#39;Small Phytoplankton!&#39;)
      string: autotrophs(1)%lname=&#39;Small Phytoplankton!&#39;

** passed all comment stripping tests **

All unit tests passed!
</pre></div>
</div>
<p>If more utility functions are added in the future, they will also be tested here.
Further, if we encounter an edge case where one of the functions misbehaves,
that edge case will be added to the tests after the function has been fixed.</p>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="regression_tests.html" class="btn btn-neutral float-right" title="Regression Tests in MARBL" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="build_tests.html" class="btn btn-neutral" title="Testing the MARBL Build System" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, National Science Foundation and U.S. Department of Energy.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
     
<script>var version_json_loc = "../../../versions.json";</script>


</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'cesm2.1',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      <script type="text/javascript" src="../../_static/pop_ver.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>