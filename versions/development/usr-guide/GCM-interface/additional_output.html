

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Additional Output &mdash; MARBL cesm2.1 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="MARBL cesm2.1 documentation" href="../../index.html"/>
        <link rel="up" title="How to Use MARBL in a GCM" href="index.html"/>
        <link rel="next" title="Shutdown" href="shutdown.html"/>
        <link rel="prev" title="Compute Interior Tracer Tendencies" href="interior_tend.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> MARBL
          

          
          </a>

          
            
            
              <div class="version">
                
                  <div class="version-dropdown">
                    <select class="version-list" id="version-list">
                      <option value=''>cesm2.1</option>
                      
                        
                          <option value="../latest">latest</option>
                        
                      
                        
                      
                    </select>
                  </div>
                
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../index.html">Marine Biogeochemistry Library</a></li>
</ul>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">MARBL user guide</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html">How to Use MARBL in a GCM</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="init.html">Init</a></li>
<li class="toctree-l3"><a class="reference internal" href="GCM_requirements/index.html">Requirements on the GCM</a></li>
<li class="toctree-l3"><a class="reference internal" href="surface_flux.html">Compute Surface Fluxes</a></li>
<li class="toctree-l3"><a class="reference internal" href="interior_tend.html">Compute Interior Tracer Tendencies</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Additional Output</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#available-fields">Available Fields</a></li>
<li class="toctree-l4"><a class="reference internal" href="#requesting-output">Requesting Output</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="shutdown.html">Shutdown</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../implementations/index.html">Examples of MARBL Implementation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev-guide/index.html">MARBL developer’s guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sci-guide/index.html">MARBL scientific documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev-guide/repo-access/index.html">Rules of engagement</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">MARBL</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">MARBL user guide</a> &raquo;</li>
        
          <li><a href="index.html">How to Use MARBL in a GCM</a> &raquo;</li>
        
      <li>Additional Output</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/usr-guide/GCM-interface/additional_output.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="additional-output-1">
<span id="additional-output"></span><h1>Additional Output<a class="headerlink" href="#additional-output-1" title="Permalink to this headline">¶</a></h1>
<p>MARBL can provide more output than just surface fluxes and interior tendencies.
For example, MARBL can return the total chlorophyll concentration to the GCM,
which can then be used to compute shortwave absorption.
(MARBL can provide both surface chlorophyll and the full depth chlorophyll field,
since difference shortwave absorption algorithms have different inputs.)
MARBL can also provide the O2, CO2, and NHx fluxes at the surface if the GCM wants those to feedback to the atmosphere.</p>
<div class="section" id="available-fields">
<h2>Available Fields<a class="headerlink" href="#available-fields" title="Permalink to this headline">¶</a></h2>
<p>The full list of outputs is available from the <code class="docutils literal notranslate"><span class="pre">available_output</span></code> regression test.
In the default configuration, the complete list is</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>------------------------
Available output for GCM
------------------------

1. Total Chlorophyll Concentration
  short name: total_Chl
  units: mg/m^3
  field_source: interior_tendency
2. Total Surface Chlorophyll Concentration
  short name: total_surfChl
  units: mg/m^3
  field_source: surface_flux
3. NHx Surface Emissions
  short name: flux_nhx
  units: nmol/cm^2/s
  field_source: surface_flux
4. Carbon Dioxide Flux
  short name: flux_co2
  units: nmol/cm^2/s
  field_source: surface_flux
5. Oxygen Flux
  short name: flux_o2
  units: nmol/cm^2/s
  field_source: surface_flux
</pre></div>
</div>
</div>
<div class="section" id="requesting-output">
<h2>Requesting Output<a class="headerlink" href="#requesting-output" title="Permalink to this headline">¶</a></h2>
<p>By default, MARBL will not return any of the additional output.
To request one or more of these fields,
use the <code class="docutils literal notranslate"><span class="pre">add_output_for_GCM()</span></code> function on the MARBL interface:</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="k">subroutine </span><span class="n">add_output_for_GCM</span><span class="p">(</span><span class="n">this</span><span class="p">,</span><span class="w"> </span><span class="n">num_elements</span><span class="p">,</span><span class="w"> </span><span class="n">field_name</span><span class="p">,</span><span class="w"> </span><span class="n">output_id</span><span class="p">,</span><span class="w"> </span><span class="n">field_source</span><span class="p">,</span><span class="w"> </span><span class="n">num_levels</span><span class="p">)</span>
<span class="w">  </span><span class="c">! Check the registry to see if field_name is provided from surface_flux_compute() or interior_tendency_compute()</span>
<span class="w">  </span><span class="c">! add it to the proper output_for_GCM type, or log a useful error message</span>

<span class="w">  </span><span class="k">use </span><span class="n">marbl_interface_public_types</span><span class="p">,</span><span class="w"> </span><span class="k">only</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">marbl_output_for_GCM_linked_list_type</span>

<span class="w">  </span><span class="k">class</span><span class="w"> </span><span class="p">(</span><span class="n">marbl_interface_class</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">this</span>
<span class="w">  </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="w">     </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w">    </span><span class="kd">::</span><span class="w"> </span><span class="n">field_name</span>
<span class="w">  </span><span class="kt">integer</span><span class="p">(</span><span class="n">int_kind</span><span class="p">),</span><span class="w">    </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w">    </span><span class="kd">::</span><span class="w"> </span><span class="n">num_elements</span>
<span class="w">  </span><span class="kt">integer</span><span class="p">(</span><span class="n">int_kind</span><span class="p">),</span><span class="w">    </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w">   </span><span class="kd">::</span><span class="w"> </span><span class="n">output_id</span>
<span class="w">  </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="w">     </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w">   </span><span class="kd">::</span><span class="w"> </span><span class="n">field_source</span>
<span class="w">  </span><span class="kt">integer</span><span class="p">(</span><span class="n">int_kind</span><span class="p">),</span><span class="w">    </span><span class="k">optional</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">num_levels</span>
</pre></div>
</div>
<p>The output field <code class="docutils literal notranslate"><span class="pre">field_source</span></code> will be  <code class="docutils literal notranslate"><span class="pre">interior_tendency_output</span></code> or <code class="docutils literal notranslate"><span class="pre">surface_flux_output</span></code>
component of the MARBL interface type.
The following block of code from the stand-alone driver shows how to request both surface and total chlorophyll.
Note that the driver tracks how many outputs are coming from <code class="docutils literal notranslate"><span class="pre">field_source</span> <span class="pre">=</span> <span class="pre">&quot;surface_flux&quot;</span></code>
and how many come from <code class="docutils literal notranslate"><span class="pre">field_source</span> <span class="pre">=</span> <span class="pre">&quot;interior_tendency&quot;</span></code>.</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">base_bio_on</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">  do </span><span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="p">(</span><span class="n">marbl_instances</span><span class="p">)</span>
<span class="w">    </span><span class="k">call </span><span class="n">marbl_instances</span><span class="p">(</span><span class="n">n</span><span class="p">)%</span><span class="n">add_output_for_GCM</span><span class="p">(</span><span class="n">num_elements</span><span class="o">=</span><span class="n">col_cnt</span><span class="p">(</span><span class="n">n</span><span class="p">),</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                                              </span><span class="n">field_name</span><span class="o">=</span><span class="s2">&quot;total_surfChl&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                                              </span><span class="n">output_id</span><span class="o">=</span><span class="n">total_surfChl_id</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                                              </span><span class="n">field_source</span><span class="o">=</span><span class="n">field_source</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">marbl_instances</span><span class="p">(</span><span class="n">n</span><span class="p">)%</span><span class="n">StatusLog</span><span class="p">%</span><span class="n">labort_marbl</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">      call </span><span class="n">marbl_instances</span><span class="p">(</span><span class="n">n</span><span class="p">)%</span><span class="n">StatusLog</span><span class="p">%</span><span class="n">log_error_trace</span><span class="p">(</span><span class="s1">&#39;marbl%add_output_for_GCM(total_surfChl)&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">subname</span><span class="p">)</span>
<span class="w">      </span><span class="k">return</span>
<span class="k">    end if</span>
<span class="k">  end do</span>
<span class="k">  if</span><span class="w"> </span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">field_source</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;surface_flux&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">    </span><span class="n">sfo_cnt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sfo_cnt</span><span class="o">+</span><span class="mi">1</span>
<span class="w">  </span><span class="k">else if</span><span class="w"> </span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">field_source</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;interior_tendency&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">    </span><span class="n">ito_cnt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ito_cnt</span><span class="o">+</span><span class="mi">1</span>
<span class="w">  </span><span class="k">else</span>
<span class="k">    write</span><span class="p">(</span><span class="n">log_message</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;(3A)&quot;</span><span class="p">)</span><span class="w"> </span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">trim</span><span class="p">(</span><span class="n">field_source</span><span class="p">),</span><span class="w"> </span><span class="s2">&quot;&#39; is not a recognized field source (total_surfChl)&quot;</span>
<span class="w">    </span><span class="k">call </span><span class="n">driver_status_log</span><span class="p">%</span><span class="n">log_error</span><span class="p">(</span><span class="n">log_message</span><span class="p">,</span><span class="w"> </span><span class="n">subname</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span>
<span class="k">  end if</span>
<span class="k">end if</span>

<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">base_bio_on</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">  do </span><span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="p">(</span><span class="n">marbl_instances</span><span class="p">)</span>
<span class="w">    </span><span class="k">call </span><span class="n">marbl_instances</span><span class="p">(</span><span class="n">n</span><span class="p">)%</span><span class="n">add_output_for_GCM</span><span class="p">(</span><span class="n">num_elements</span><span class="o">=</span><span class="n">col_cnt</span><span class="p">(</span><span class="n">n</span><span class="p">),</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                                              </span><span class="n">field_name</span><span class="o">=</span><span class="s2">&quot;total_Chl&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                                              </span><span class="n">output_id</span><span class="o">=</span><span class="n">total_Chl_id</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                                              </span><span class="n">num_levels</span><span class="o">=</span><span class="n">num_levels</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                                              </span><span class="n">field_source</span><span class="o">=</span><span class="n">field_source</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">marbl_instances</span><span class="p">(</span><span class="n">n</span><span class="p">)%</span><span class="n">StatusLog</span><span class="p">%</span><span class="n">labort_marbl</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">      call </span><span class="n">marbl_instances</span><span class="p">(</span><span class="n">n</span><span class="p">)%</span><span class="n">StatusLog</span><span class="p">%</span><span class="n">log_error_trace</span><span class="p">(</span><span class="s1">&#39;marbl%add_output_for_GCM(total_Chl)&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">subname</span><span class="p">)</span>
<span class="w">      </span><span class="k">return</span>
<span class="k">    end if</span>
<span class="k">  end do</span>
<span class="k">  if</span><span class="w"> </span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">field_source</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;surface_flux&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">    </span><span class="n">sfo_cnt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sfo_cnt</span><span class="o">+</span><span class="mi">1</span>
<span class="w">  </span><span class="k">else if</span><span class="w"> </span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">field_source</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;interior_tendency&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">    </span><span class="n">ito_cnt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ito_cnt</span><span class="o">+</span><span class="mi">1</span>
<span class="w">  </span><span class="k">else</span>
<span class="k">    write</span><span class="p">(</span><span class="n">log_message</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;(3A)&quot;</span><span class="p">)</span><span class="w"> </span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">trim</span><span class="p">(</span><span class="n">field_source</span><span class="p">),</span><span class="w"> </span><span class="s2">&quot;&#39; is not a recognized field source (total_Chl)&quot;</span>
<span class="w">    </span><span class="k">call </span><span class="n">driver_status_log</span><span class="p">%</span><span class="n">log_error</span><span class="p">(</span><span class="n">log_message</span><span class="p">,</span><span class="w"> </span><span class="n">subname</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span>
<span class="k">  end if</span>
<span class="k">end if</span>
</pre></div>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="shutdown.html" class="btn btn-neutral float-right" title="Shutdown" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="interior_tend.html" class="btn btn-neutral" title="Compute Interior Tracer Tendencies" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, National Science Foundation and U.S. Department of Energy.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
     
<script>var version_json_loc = "../../../versions.json";</script>


</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'cesm2.1',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      <script type="text/javascript" src="../../_static/pop_ver.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>